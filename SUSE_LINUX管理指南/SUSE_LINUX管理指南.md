10.1 特殊软件包的相关信息
---

10.1.1 包bash 和/etc/profile

bash被用作登录shell时读取所有的init文件，bash处理顺序
1. /etc/profile
2. ~/.profile
3. /etc/bash.bashrc
4. ~/.bashrc

10.1.2 cron包
cron表位于 /var/spool/cron/tabs 中，/etc/crontab用作整个系统范围的cron表

例如 
```txt
用户rich创建一个用户crotab
rich@linux-sm1i:~> crontab -e

在这里/var/spool/cron/tabs/ 就可以查到创建的内容
linux-sm1i:~ # cat /var/spool/cron/tabs/rich 
# DO NOT EDIT THIS FILE - edit the master and reinstall.
# (/tmp/crontab.S0t4GS installed on Fri Apr 19 14:13:16 2019)
# (Cronie version 4.2)
1 * * * * root test -x /user/sbin/atrun
```
10.1.3 日志文件： 包logrotate

linux-sm1i:~ # cat /etc/logrotate.conf

10.1.5 locate命令

快速查找文件的locate,updatedb每天晚上或者系统引导系统后15分钟自动启动

10.1.6 ulimit命令

使用ulimit(user limit)命令、可以对系统资源的使用设置限制并将这些信息显示出来。ulimt尤其适用于限制应用程序的可用内存。使用此命令，可以防止某个应用程序占用太多内存。

可以对ulimit使用多个选项，要限制内存请使用表10.1 ulimit:为用户设置资源 列出的选项

|选项|说明|
|:---:|:---|
|-m|物理内存最大大小|
|-v|虚拟内存最大大小|
|-s|堆栈的最大大小|
|-c|核心文件的最大大小|
|-a|显示限制设置|

10.1.7 free命令

linux-sm1i:~ # cat /proc/meminfo

10.1.8 文件/etc/resolv.conf

系统通过/etc/resolv.conf处理域名解析，此文件仅由脚本/sbin/modify_resolvconf进行更新，任何其它程序都没有直接修改/etc/resolv.conf的权限，只有实施这条规则才能确保系统网络配置和相关文件保持一致。

10.1.10 vi

vi基本上采用三种操作方式：插入方式、命令方式、和扩展方式。启动的时候vi通常是扩展方式。

命令方式切换到插入方式，有多种选择，1. 使用a 追加； 2. 使用i 插入 ；3. 使用o 新行

插入方式切换到命令方式，按esc

命令方式切换到扩展方式，通过输入 ：可以激活vi扩展方式，扩展或者ex方式就像一个独立的面向行的编辑器，可用于多种简单和较复杂的任务 

H光标左移一个字符  J下移一行  K上移一行  L右移一行

36 系统监视实用程序
---

36.1 打开文件的列表 lsof

查看具有进程ID(PID)的进程打开的所有文件列表，请使用-p 例如要查看当前shell使用的所有文件输入
```txt
linux-sm1i:~ # lsof -p $$
COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF  NODE NAME
bash    19979 root  cwd    DIR   0,40      106  7024 /root
bash    19979 root  rtd    DIR   0,40      156   256 /
bash    19979 root  txt    REG   0,40   697816 31033 /bin/bash
```
使用了特殊shell变量$$ ,它的值是shell的进程ID

如果不带任何参数使用lsof，它将列出当前打开的所有文件。由于数量太多，我们通常通过grep过滤，例如列出字符设备linux-sm1i:~ # lsof |grep CHR

36.2 访问文件的用户 fuser

用于定位哪些进程或用户正在访问特定的文件。例如要卸载已装入的/mnt ,文件系统，但是系统提示“设备正忙”
，然后使用fuser命令查看哪些进程正在访问该设备
```txt
linux-sm1i:~ # fuser -v /usr/sbin/cron 
                     USER        PID ACCESS COMMAND
/usr/sbin/cron:      root       2155 ...e. cron
```

36.3 文件属性 stat
```txt
linux-sm1i:~ # stat  /usr/sbin/cron 
  File: '/usr/sbin/cron'
  Size: 68264     	Blocks: 136        IO Block: 4096   regular file
Device: 28h/40d	Inode: 83328       Links: 1
Access: (0755/-rwxr-xr-x)  Uid: (    0/    root)   Gid: (    0/    root)
Access: 2019-04-19 11:04:44.016885638 +0800
Modify: 2015-08-21 18:47:02.000000000 +0800
Change: 2019-04-19 10:34:45.732000000 +0800
 Birth: -
```

参数 --filesystem将生成文件所在文件系统的属性详细信息：
```txt
linux-sm1i:~ # stat --help
Usage: stat [OPTION]... FILE...
Display file or file system status.

Mandatory arguments to long options are mandatory for short options too.
  -L, --dereference     follow links
  -f, --file-system     display file system status instead of file status

linux-sm1i:~ # stat . -f
  File: "."
    ID: 89496ebc27af4157 Namelen: 255     Type: btrfs
Block size: 4096       Fundamental block size: 4096
Blocks: Total: 3148800    Free: 1763995    Available: 1681159
Inodes: Total: 0          Free: 0
linux-sm1i:~ # stat . --file-system 
  File: "."
    ID: 89496ebc27af4157 Namelen: 255     Type: btrfs
Block size: 4096       Fundamental block size: 4096
Blocks: Total: 3148800    Free: 1763995    Available: 1681159
Inodes: Total: 0          Free: 0
```

36.4 lsusb   加-v参数显示更详细信息

36.5 关于SCSI设备的信息 lsscsi
```txt
linux-sm1i:~ # lsscsi 
[0:0:0:0]    disk    ATA      VBOX HARDDISK    1.0   /dev/sda 
[2:0:0:0]    cd/dvd  VBOX     CD-ROM           1.0   /dev/sr0 
```
36.6 进程top

top进程每两秒刷新一次。按q退出，参数-n 1 在显示一次进程列表后终止程序

参数-U UID只监视特定用户关联进程，top -U $(id -u username)根据用户名返回用户的UID并显示该用户的进程
```txt
linux-sm1i:~ # id rich
uid=1000(rich) gid=100(users) groups=100(users)
linux-sm1i:~ # top -U 1000
```
36.7 进程列表 ps

命令ps生成进程列表，如果添加了参数r ,则显示正在使用计算时间的进程

ps ax --formart pid,rss,cmd --sort rss

36.8 进程树 pstree

36.9 哪些用户在执行哪些操作 w

36.10 内存使用 free
```txt
inux-sm1i:~ # free
             total       used       free     shared    buffers     cached
Mem:       1860264    1762916      97348      12136        348    1391168
-/+ buffers/cache:     371400    1488864
Swap:      2103292          0    2103292
```
-/+ buffers/cache:     371400    1488864 

这将计算缓冲区和超速缓存所占用的内存量，参数-d delay可以确保每秒刷新一次

36.11 内核信号缓冲区 dmesg

Linux内核在信号缓存区保存某些讯息

36.12 文件系统及其使用 mount 、df和du

mount 显示哪个挂载点挂载哪个文件系统

df 加-h输出为普通用户可以理解的形式

36.13 /proc文件系统

/proc文件系统是一个伪文件系统，在该文件系统中，内核以虚拟文件的形式保留重要信息。
```txt
linux-sm1i:~ # cat /proc/cpuinfo 
processor	: 0
vendor_id	: GenuineIntel
cpu family	: 6
model		: 78
model name	: Intel(R) Core(TM) i5-6200U CPU @ 2.30GHz
stepping	: 3
cpu MHz		: 2400.012
cache size	: 3072 KB
physical id	: 0
siblings	: 1
core id		: 0
cpu cores	: 1
```
- /proc/interrupts  查看中断信息
- /proc/devices  可用设备
- /proc/modules  装载的内核模块
- /proc/cmdline  内存信息
- /proc/meminfo   内核的gzip压缩配置文件

36.14 vmstat、 iostat、和mpstat

- vmstat 报告虚拟内存信息
- iostat 报告有关CPU以及设备与分区输入输出的统计信息，所显示文件出自/proc/stat 和/proc/partitions
- mpstat 命令输出与CPU相关统计信息

注意iostat 和mpstat 需要安装zypper install sysstat
```txt
linux-sm1i:~ # vmstat
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 0  0      0  79432    348 1407768    0    0    95   219   36  101  1  1 97  1  0

linux-sm1i:~ # mpstat
Linux 4.12.14-94.41-default (linux-sm1i) 	04/19/19 	_x86_64_	(1 CPU)

16:20:38     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
16:20:38     all    1.36    0.02    0.85    0.99    0.00    0.01    0.00    0.00    0.00   96.77

linux-sm1i:~ # iostat
Linux 4.12.14-94.41-default (linux-sm1i) 	04/19/19 	_x86_64_	(1 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           1.36    0.02    0.86    0.99    0.00   96.77

Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda               3.48        77.29       228.95     902660    2673748
scd0              0.19        18.76         0.00     219050          0
```
36.15 procinfo

命令procinfo 对/proc文件系统中重要信息进行了总结
```txt
linux-sm1i:~ # procinfo 
Linux 4.12.14-94.41-default (geeko@buildhost) (gcc 4.8.5) #1 1CPU [linux-sm1i]

Memory:      Total        Used        Free      Shared     Buffers      Cached
Mem:       1860264     1741368      118896           0        2180     1421968
Swap:      2103292           0     2103292
```
要查看所有信息，使用参数-a ，参数-nN每N秒更新一次，q退出 -d生成差异值 procinfo -dn5显示5秒内的差异值

36.16 PCI资源lspci

-v 参数可以显示更详细列表

36.17 程序运行的系统调用 strace

#strace -e open ls

36.19 指定必需的库 ldd

命令ldd可用于找出哪些库将装载以参数形式指定的动态可执行文件
```txt
linux-sm1i:~ # ldd /bin/ls
	linux-vdso.so.1 (0x00007ffd43795000)
	libselinux.so.1 => /lib64/libselinux.so.1 (0x00007f205eff4000)
	libcap.so.2 => /lib64/libcap.so.2 (0x00007f205edef000)
	libc.so.6 => /lib64/libc.so.6 (0x00007f205ea4a000)
	libpcre.so.1 => /usr/lib64/libpcre.so.1 (0x00007f205e7db000)
	libdl.so.2 => /lib64/libdl.so.2 (0x00007f205e5d7000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f205f21a000)
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f205e3ba000)
linux-sm1i:~ # 
```
